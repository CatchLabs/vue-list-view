"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function ListView(){var itemComponent=arguments.length<=0||void 0===arguments[0]?{template:""}:arguments[0];return itemComponent.props={item:{type:Object}},{template:'\n            <div class="list-view" @scroll="scrollHandler" style="overflow-x: hidden">\n                <slot name="list-start"></slot>\n                <div v-for="item in items" class="list-view-item" :style="{height: placeholders[$index] + \'px\'}">\n                    <list-view-item v-if="visibility[$index]" :item="item"></list-view-item>\n                </div>\n                <slot name="list-end"></slot>\n            </div>\n        ',props:{items:{type:Array,required:!0},preloadScreens:{type:Number,"default":3}},components:{listViewItem:itemComponent},data:function(){return{placeholders:[],visibility:[],scrollHeight:0}},methods:{scrollHandler:(0,_throttle2["default"])(function(){var _this=this,el=this.$el;el&&(_fastdom2["default"].mutate(function(){var scrollTop=el.scrollTop;innerHeight+scrollTop>=_this.scrollHeight&&_this.$dispatch("list-view:scrolled-to-end")}),this.checkVisibility())},1e3),checkVisibility:function(){var _this2=this,preloadHeight=this.preloadScreens*innerHeight,els=this.$el.querySelectorAll(".list-view-item"),visibility=this.visibility;_fastdom2["default"].measure(function(){for(var scrollTop=_this2.$el.scrollTop,_loop=function(i,len){_fastdom2["default"].measure(function(){if(els[i]){var top=els[i].offsetTop-scrollTop,bottom=top+_this2.placeholders[i];visibility[i]=bottom>-preloadHeight&&preloadHeight>top,i==len-1&&visibility.$set(0,visibility[0])}})},i=0,len=_this2.items.length;len>i;i++)_loop(i,len)})}},watch:{items:function(_items){for(var _this3=this,placeholders=this.placeholders,visibility=this.visibility,i=0;i<_items.length;i++)visibility[i]=!0;visibility.$set(0,visibility[0]),this.$nextTick(function(){_fastdom2["default"].measure(function(){return _this3.scrollHeight=_this3.$el.scrollHeight}),setTimeout(function(){for(var els=_this3.$el.querySelectorAll(".list-view-item"),_loop2=function(i,len){_fastdom2["default"].measure(function(){placeholders[i]=els[i].offsetHeight||null,i==len-1&&placeholders.$set(0,placeholders[0])})},i=0,len=els.length;len>i;i++)_loop2(i,len);_this3.checkVisibility()},100)})}}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=ListView;var _throttle=require("lodash/throttle"),_throttle2=_interopRequireDefault(_throttle),_fastdom=require("fastdom"),_fastdom2=_interopRequireDefault(_fastdom),innerHeight=window.innerHeight;